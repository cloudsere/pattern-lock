"use strict";function init(){function a(){var a=[];if(document.documentElement.getBoundingClientRect())for(var c=0;c<y.length;c++){var d=y[c].getBoundingClientRect(),e=d.left,f=d.top,g={x:e,y:f,centerx:e+u/2,centery:f+u/2};a.push(g)}else for(var c=0;c<y.length;c++){var d=b(y[c]);a.push(d)}return a}function b(a){for(var b=0,c=0;null!=a;b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent);return{x:b,y:c,centerx:b+u/2,centery:c+u/2}}function c(a,b){for(var c=-1,d=0;d<z.length;d++){var e=z[d].x,f=z[d].y;if(e<=a&&a<=e+u&&f<=b&&b<=f+u){c=d;break}}return c}function d(){o=[],q=!1;for(var a=0;a<y.length;a++)y[a].classList.remove("activeCircle"),y[a].classList.remove("activeTwice")}function e(a){var b=localStorage.getItem("password"),c=JSON.stringify(a);if(s)return void(b?n(b===c?7:6):alert("请您先设置密码"));if(!p)return void(a.length<t?n(2):(n(3),p=c));if(p){if(p!==c)return void(b===p?a.length>=t?(p=c,n(9)):(p="",n(10)):(p="",n(4)));n(5),localStorage.setItem("password",c)}}function f(a){a.preventDefault(),q=!0}function g(a){a&&(a.preventDefault(),a.stopPropagation()),0!==o.length&&(1===o.length&&n(2),o[0]===o[1]&&o.shift(),e(o),d(),l())}function h(a){if(a.preventDefault(),a.touches){r=!0;var b=a.touches[0],d=b.pageX,e=b.pageY,f=c(d,e);if(f>=0&&f!==o[o.length-1]){o.push(f);var g=document.getElementsByClassName("passwordCircle")[f];if(g.classList.contains("activeCircle"))return void g.classList.add("activeTwice");g.classList.add("activeCircle"),k(f)}}}function i(a,b){var c=x.getBoundingClientRect().left,d=x.getBoundingClientRect().right;c<=a&&a<=c+220&&d<=b&&b<=d+220||g()}function j(a){v.width=window.innerWidth,v.height=window.innerHeight,w.strokeStyle="#f25666",w.beginPath(),w.lineWidth=3;var b=z[a].centerx,c=z[a].centery;w.moveTo(b,c)}function k(a){var b=z[a].centerx,c=z[a].centery;w.lineTo(b,c),w.stroke()}function l(){w.closePath(),w.clearRect(0,0,v.width,v.height)}function m(a){"test"===a.value?(n(8),s=!0):(n(1),s=!1)}function n(a){var b=document.getElementsByClassName("tooltip")[0],c="";switch(a){case 1:c="<p>请输入手势密码</p>";break;case 2:c="<p>密码太短，至少需要5个点</p>";break;case 3:c="<p>请再次输入手势密码</p>";break;case 4:c="<p>两次输入的不一致,重新设置</p>";break;case 5:c="<p>密码设置成功</p>";break;case 6:c="<p>输入的密码不正确</p>";break;case 7:c="<p>密码正确！</p>";break;case 8:c="<p>请验证手势密码</p>";break;case 9:c="<p>您在重设密码，请再次输入确认</p>";break;case 10:c="<p>重设密码请输入至少5个点</p>"}b.innerHTML=c}var o=[],p="",q=!1,r=!1,s=!1,t=5,u=50,v=document.getElementById("myCanvas"),w=v.getContext("2d"),x=document.getElementsByClassName("password")[0],y=document.getElementsByClassName("passwordCircle"),z=a();window.addEventListener("resize",function(){z=a()},!1),x.addEventListener("touchstart",f,!1),x.addEventListener("touchmove",h,!1),x.addEventListener("touchend",g,!1),x.addEventListener("mousedown",f,!1),x.addEventListener("mousemove",h,!1),x.addEventListener("mouseup",g,!1),function(){for(var a=0;a<y.length;a++)!function(a){function b(b){q=!0,this.classList.add("activeCircle"),o.push(a),j(a)}function c(b){if(q&&!r){if(o.push(a),k(a),this.classList.contains("activeCircle"))return void this.classList.add("activeTwice");this.classList.add("activeCircle")}}y[a].addEventListener("mousedown",b,!1),y[a].addEventListener("touchstart",b,!1),y[a].addEventListener("mouseover",c,!1)}(a)}(),document.documentElement.addEventListener("mouseup",i,!1);for(var A=document.forms[0].elements.password,B=0;B<A.length;B++)A[B].onclick=function(){m(this)}}